# NMAP

Pour avoir une idée de l'état de sécurité d'un site (une ou plusieurs IP), il faut commencer à comprendre son environnement. C'est à dire les services qui s'executent sur la cible. Certains peuvent etre un webserveur, d'autres un Controller de domaine d'Active Directory. Le début est donc d'établir une map de ce paysage et c'est le principe de "Port Scanning"

Les ports sont nécessaires pour faire plusieurs requetes réseau ou d'avoir plusieurs services. C'est ce qui permet d'avoir plusieurs onglets par exemple et de diriger le traffic vers le service approprié (donc un service pour un port, car le service va "listen" le port). La connection se fait donc entre un port qui est écouté et un port aléatoire de l'ordinateur emetteur.

image::https://i.imgur.com/3XAfRpI.png[Port_Management]

Tous les ordinateurs ont 65535 ports disponibles ce qui permet d'avoir beaucoup de service, cependant beaucoup de ces prots sont enregistrés en tant que ports standard, parce que exemple, le webservice HTTP est le 80 par défaut, tandis que le HTTPS est le 443. Dans certains cas, il est possible que ces ports soient alterés. C'est pour cela qu'il est improtant de récupérer ces informations lors d'une analyse. Port connus :

* 53 : DNS
* 80 : HTTP
* 443 : HTTPS
* 139 : Windows NETBIOS
* 445: SMB

Mais aussi par catégorie:

* 0 à 1023 sont pour les protocoles TCP/IP (donc 1024 ports)

## Port Scanning

Pour effectuer un Port Scanning, il y a plusieurs façons de faire. Un outil très connu est Nmap qui permet de faire plusieurs types de port scan. La façon est basique est de se connecter à chaque port du destinataire et determine en fonction de la réponse si le port est ouvet/fermé ou filtré (firewall).

Une fois que les ports sont connus, on peut regarder quels services sont associés à quels ports (manuellement ou avec nmap). Nmap est actuellement le standard dans l'industry car c'est un outil très puissant, très rapide et avec veaucoup de fonctionnalité. Il dispose aussi d'un scripting engine qui permet de scan pour des vulnérabilités et voir même de tester des exploits sur ces vulnérabilités

## Nmap Switches

Nmap n'est pas installé par défaut (sauf Kali Linux) et on y accède avec "nmap". Voici la liste des switches utiles:

Aide

* -h pour help
* man nmap

Scan: 

* -sS pour un Syn Scan
* -sU pour un UDP Scan
* -sV pour scan les services (version + infos des services qui s'executent sur la target)

Parametre de Scan

* -TX (T1 à T5) permet de changer le timing du template (Plus haut = Plus rapide)
* -p 80 pour ne scan que le port 80
* -p1000-1500 pour scan une range de port (espace ou non apres le p pas important)
* -p- permet de scan tous les ports
* --script pour activer les scripts et on ajoute la catégorie apres => --script=default OU --script=vuln

Extra informations

* -O pour avoir l'OS de la machine
* -A permet d'activer l'OS detecction, version detection, script scanning et traceroute (A => Aggresive donc si besoin d'etre discret nul, mais bien pour audit)
* -v pour verbose
* -vv pour encore plus de verboe

Output

* -oA permet d'enregistrer un scan pour éviter de le refaire et de spam le réseau (et d'etre detecté)
* -oN output le scan en Normal
* -oX output le scan en XML
* -oS en script Kiddie
* -oG en Grepable format
